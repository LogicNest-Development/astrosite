---
import Layout from "../../layouts/Layout.astro";
import ProductCard from "../../components/ProductCard.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const products = await getCollection("products");
  return products.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;

// Find the matching product entry by slug
const products = await getCollection("products");
const entry = products.find((p) => p.slug === slug);

if (!entry) {
  throw new Error(`Product not found: ${slug}`);
}

const { Content } = await entry.render();
const data = entry.data;
const title = data.title ?? entry.slug;
---

<Layout title={`${title} â€” LogicNest`}>
  <section class="container py-12 grid md:grid-cols-3 gap-8">
    <div class="md:col-span-2 prose prose-invert">
      <h1 class="text-3xl font-semibold mb-4">{title}</h1>
      <Content />
    </div>

    <aside class="md:col-span-1">
      <!-- Pass all frontmatter fields to ProductCard; it will pick what it needs -->
      <ProductCard {...data} />
    </aside>
  </section>
</Layout>
