---
import Layout from "@components/../layouts/Layout.astro";
import ProductCard from "@components/ProductCard.astro";
import groups from "@content/product-groups/*";
import products from "@content/products/*";

export async function getStaticPaths() {
  return groups.map((g) => ({ params: { slug: g.slug } }));
}

const { slug } = Astro.params;
const group = groups.find(g => g.slug === slug);
const list = products.filter(p => p.data.group === slug && p.data.enabled !== false);
---
<Layout title={`${group?.data.title ?? "Products"} â€” LogicNest`}>
  <section class="container py-12">
    <h1 class="text-3xl font-bold">{group?.data.title}</h1>
    {group?.data.hero && <p class="mt-2 text-white/70">{group.data.hero}</p>}
    <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {list.map((p) => <ProductCard product={{ ...p.data }} />)}
    </div>
  </section>

  <section class="container mt-12">
    <h2 class="text-2xl font-semibold">FAQs</h2>
    <div class="mt-4 space-y-3">
      {Astro.glob("../../content/faqs/*.md").then(mods => 
        mods.filter(m => m.frontmatter.tag === (group?.data.faqTag || "global"))
      ).then(items => items.flatMap(i => i.frontmatter.items)).then(items => 
        items?.map((qa) => (
          <details class="card p-4">
            <summary class="cursor-pointer font-medium">{qa.q}</summary>
            <div class="mt-2 text-white/70 prose prose-invert" set:html={qa.a}></div>
          </details>
        ))
      )}
    </div>
  </section>
</Layout>
