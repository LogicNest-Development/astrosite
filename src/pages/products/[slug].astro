---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import ProductCard from "@components/ProductCard.astro";

const { slug } = Astro.params;
const groups = await getCollection("product-groups");
const group = groups.find(g => g.slug === slug);

if (!group) {
  throw new Error("Group not found");
}

const products = (await getCollection("products"))
  .filter(p => p.data.group === group.slug && p.data.enabled !== false);
---
<Layout title={`${group.data.title} â€” LogicNest`}>
  <section class="container py-12">
    <h1 class="text-3xl font-bold">{group.data.title}</h1>
    {group.data.summary && <p class="text-muted mt-2">{group.data.summary}</p>}
    <div class="mt-8 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {products.map(p => (
        <ProductCard product={{
          title: p.data.title,
          price: p.data.price,
          features: p.data.features,
          badge: p.data.badge,
          image: p.data.image,
          ctaUrl: p.data.ctaUrl
        }} />
      ))}
    </div>
  </section>
</Layout>
