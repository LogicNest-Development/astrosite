---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const docs = await getCollection("legal");

// Pre-render each MD entry so we can safely render <Content /> in the template.
const items = await Promise.all(
  docs.map(async (d) => {
    const { Content } = await d.render();
    return {
      title: d.data?.title ?? d.slug,
      slug: d.slug,
      Content,
    };
  })
);

// Use ?doc=<title> to choose which legal doc shows; default to the first.
const url = new URL(Astro.request.url);
const active = url.searchParams.get("doc") ?? items[0]?.title;
---

<Layout title="Legal â€” LogicNest">
  <section class="container py-12">
    <div class="flex flex-wrap gap-2">
      {items.map((it) => (
        <a
          href={`/legal?doc=${encodeURIComponent(it.title)}`}
          class={`px-3 py-2 rounded-xl border ${active === it.title ? "bg-white/10" : "bg-transparent"} border-white/10`}
        >
          {it.title}
        </a>
      ))}
    </div>

    <div class="card p-6 mt-6 prose prose-invert">
      {items.map((it) => active === it.title && (
        <Fragment>
          <it.Content />
        </Fragment>
      ))}
    </div>
  </section>
</Layout>
