---
import Layout from "../layouts/Layout.astro";
import { getCollection, renderMarkdown } from "astro:content";

const docs = await getCollection("legal");
// choose via ?doc=Title or fall back to first
const activeTitle = Astro.url.searchParams.get("doc") ?? docs[0]?.data.title;

// find the active entry and compile its markdown
const activeDoc = docs.find((d) => d.data.title === activeTitle) ?? docs[0];
const compiled = activeDoc ? await renderMarkdown(activeDoc.body) : null;
---

<Layout title="Legal â€” LogicNest">
  <section class="container py-12">
    <!-- pill switcher -->
    <div class="flex flex-wrap gap-2">
      {docs.map((d) => (
        <a
          href={`/legal?doc=${encodeURIComponent(d.data.title)}`}
          class={`px-3 py-2 rounded-xl border border-white/10 transition ${
            (activeDoc?.data.title === d.data.title) ? "bg-white/10" : "bg-transparent hover:bg-white/5"
          }`}
        >
          {d.data.title}
        </a>
      ))}
    </div>

    <!-- paper-style card with compiled markdown -->
    <div class="mt-6 rounded-2xl border border-white/10 bg-black/20 p-6 shadow-ring prose prose-invert max-w-none">
      <article set:html={compiled?.content}></article>
    </div>
  </section>
</Layout>
